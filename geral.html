<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard Avançado de Gastos (Otimizado Mobile)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <style>
    /* Definição de variáveis de cor - Apenas Dark Mode */
    :root {
      --bs-body-font-family: 'Inter', sans-serif;
      --theme-bg: #1a1d21;
      --theme-text: #e9ecef;
      --theme-card-bg: #212529;
      --theme-card-border: #495057;
      --theme-card-header-bg: #343a40;
      --theme-muted-text: #adb5bd;
      --theme-primary-color: #4dabf7; /* Azul vibrante para dark */
      --theme-primary-gradient-start: rgba(77, 171, 247, 0.35);
      --theme-primary-gradient-end: rgba(77, 171, 247, 0.01);
      --theme-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }

    body {
      background-color: var(--theme-bg);
      color: var(--theme-text);
      font-family: var(--bs-body-font-family);
      min-width: 320px; /* Evita quebra em telas extremamente pequenas */
    }

    /* Ajuste no padding do container-fluid para telas menores */
    .container-fluid {
        padding-left: 0.75rem; /* Menor padding inicial */
        padding-right: 0.75rem;
    }
    @media (min-width: 576px) {
        .container-fluid {
            padding-left: 1rem;
            padding-right: 1rem;
        }
    }
    @media (min-width: 768px) {
        .container-fluid {
            padding-left: 1.5rem;
            padding-right: 1.5rem;
        }
    }
    @media (min-width: 992px) {
        .container-fluid {
            padding-left: 2rem;
            padding-right: 2rem;
        }
    }


    .dashboard-header {
        margin-bottom: 2rem; /* Ajuste leve */
        /* Padding já tratado pelo container-fluid */
    }

    .dashboard-title {
      color: var(--theme-primary-color);
      font-weight: 700;
      font-size: 1.75rem; /* Um pouco menor */
      margin: 0;
    }

    .chart-card, .kpi-card {
      background-color: var(--theme-card-bg);
      border: 1px solid var(--theme-card-border);
      border-radius: 0.75rem;
      box-shadow: var(--theme-shadow);
      margin-bottom: 1.5rem; /* Espaçamento padrão */
      overflow: hidden;
      height: 100%;
    }

    .card-header {
      background-color: var(--theme-card-header-bg);
      border-bottom: 1px solid var(--theme-card-border);
      font-weight: 600;
      font-size: 0.9rem; /* Um pouco menor */
      padding: 0.65rem 1rem; /* Ajuste padding */
      color: var(--theme-text);
    }

    .card-body {
        padding: 1rem; /* Reduzido padding interno */
    }

    .kpi-card .card-body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        height: 100%;
        min-height: 100px; /* Altura mínima para KPIs */
    }

    .kpi-title {
        font-size: 0.85rem; /* Um pouco menor */
        font-weight: 500;
        color: var(--theme-muted-text);
        margin-bottom: 0.3rem; /* Menor margem */
    }

    .kpi-value {
        font-size: 1.6rem; /* Ajustado */
        font-weight: 700;
        color: var(--theme-primary-color);
        word-wrap: break-word;
    }

    /* Ajustes finos nos gráficos ApexCharts */
    .apexcharts-tooltip {
      background: var(--theme-card-bg) !important;
      color: var(--theme-text) !important;
      border: 1px solid var(--theme-card-border) !important;
    }
    .apexcharts-tooltip .apexcharts-tooltip-title {
      background: var(--theme-card-header-bg) !important;
      border-bottom: 1px solid var(--theme-card-border) !important;
      color: var(--theme-text) !important;
    }
    .apexcharts-xaxis-label, .apexcharts-yaxis-label {
        fill: var(--theme-muted-text) !important;
        font-family: var(--bs-body-font-family) !important;
        font-size: 11px !important; /* Garante tamanho consistente */
    }
     .apexcharts-legend-text {
        color: var(--theme-muted-text) !important;
        font-family: var(--bs-body-font-family) !important;
        font-size: 12px !important;
     }

    /* Responsividade Específica Mobile */
    @media (max-width: 767.98px) { /* md e abaixo */
        .dashboard-title {
          font-size: 1.5rem; /* Menor título */
          margin-bottom: 0.5rem;
        }
        .dashboard-header {
            margin-bottom: 1.5rem;
        }
        .kpi-card {
           height: auto; /* Altura automática no mobile */
        }
        .kpi-value {
           font-size: 1.5rem; /* Levemente menor no mobile */
        }
    }
     @media (max-width: 575.98px) { /* sm e xs */
        .card-body {
            padding: 0.75rem; /* Menos padding ainda */
        }
        .kpi-value {
           font-size: 1.4rem; /* Menor ainda no xs */
        }
         .apexcharts-xaxis-label {
             font-size: 10px !important; /* Menor fonte eixo X */
         }
    }
  </style>
</head>
<body>
  <div class="container-fluid py-3 py-md-4">
    <div class="dashboard-header">
      <h1 class="dashboard-title">Dashboard Geral de Gastos</h1>
    </div>

    <div class="row">
        <div class="col-xl-3 col-lg-6 col-md-6 col-12 mb-4">
           <div class="kpi-card">
              <div class="card-body">
                  <div class="kpi-title">Gasto Total (Trimestre)</div>
                  <div class="kpi-value" id="kpi-total-geral">R$ 0,00</div>
              </div>
            </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 col-12 mb-4">
           <div class="kpi-card">
              <div class="card-body">
                  <div class="kpi-title">Gasto Total (Janeiro)</div>
                  <div class="kpi-value" id="kpi-janeiro">R$ 0,00</div>
              </div>
            </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 col-12 mb-4">
           <div class="kpi-card">
              <div class="card-body">
                  <div class="kpi-title">Gasto Total (Fevereiro)</div>
                  <div class="kpi-value" id="kpi-fevereiro">R$ 0,00</div>
              </div>
            </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 col-12 mb-4">
           <div class="kpi-card">
              <div class="card-body">
                  <div class="kpi-title">Gasto Total (Março)</div>
                  <div class="kpi-value" id="kpi-marco">R$ 0,00</div>
              </div>
            </div>
        </div>
    </div>

    <div class="row"> <div class="col-12">
            <div class="chart-card"> <div class="card-header text-center">
                    Evolução Mensal dos Gastos
                </div>
                <div class="card-body">
                    <div id="chartMensal"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
      <div class="col-lg-4 col-md-6 col-12 mb-4">
        <div class="chart-card">
          <div class="card-header text-center">
            Gastos Semanais - Janeiro
          </div>
          <div class="card-body">
            <div id="chartSemanalJaneiro"></div>
          </div>
        </div>
      </div>

      <div class="col-lg-4 col-md-6 col-12 mb-4">
        <div class="chart-card">
          <div class="card-header text-center">
            Gastos Semanais - Fevereiro
          </div>
          <div class="card-body">
            <div id="chartSemanalFevereiro"></div>
          </div>
        </div>
      </div>

      <div class="col-lg-4 col-md-12 col-12 mb-4"> <div class="chart-card">
          <div class="card-header text-center">
            Gastos Semanais - Março
          </div>
          <div class="card-body">
            <div id="chartSemanalMarco"></div>
          </div>
        </div>
      </div>
    </div>
  </div> <script>
    // ===================================================================
    // FUNÇÃO AUXILIAR PARA FORMATAR MOEDA
    // ===================================================================
    const formatCurrency = (val) => {
      if (val === null || val === undefined) return "R$ 0,00";
      return "R$ " + val.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    };

    // ===================================================================
    // FUNÇÃO AUXILIAR PARA CRIAR OPÇÕES DO GRÁFICO DE ÁREA (DARK MODE)
    // ===================================================================
    /**
     * Cria um objeto de configuração padrão para os gráficos de área ApexCharts (Tema Dark Fixo).
     * @param {string} chartId - O ID do elemento HTML onde o gráfico será renderizado.
     * @param {Array<number>} seriesData - Array com os dados da série do gráfico.
     * @param {Array<string>} categories - Array com as categorias do eixo X.
     * @param {string} seriesName - Nome da série de dados (para tooltip e legenda).
     * @param {number} chartHeight - Altura base do gráfico.
     * @returns {object} Objeto de configuração para ApexCharts.
     */
    function createAreaChartOptions(chartId, seriesData, categories, seriesName = 'Valor', chartHeight = 300) {
      // Cores definidas diretamente para Dark Mode (baseadas nas variáveis CSS)
      const primaryColor = '#4dabf7';
      const gridColor = '#404040';
      const cardBgColor = '#212529'; // Cor de fundo do card para a borda do marcador

      return {
        chart: {
          id: chartId,
          type: 'area',
          height: chartHeight,
          background: 'transparent',
          toolbar: { show: true, tools: { download: true, selection: false, zoom: false, zoomin: false, zoomout: false, pan: false, reset: false } },
          fontFamily: 'Inter, sans-serif',
          zoom: { enabled: false },
          animations: {
             enabled: true,
             easing: 'easeinout',
             speed: 600, // Um pouco mais rápido
             animateGradually: { enabled: false }, // Desabilitar para performance mobile
             dynamicAnimation: { enabled: true, speed: 300 }
          }
        },
        dataLabels: {
          enabled: false
        },
        stroke: {
          curve: 'smooth',
          width: 2 // Linha mais fina
        },
        fill: {
          type: 'gradient',
          gradient: {
            shadeIntensity: 1,
            opacityFrom: 0.6,
            opacityTo: 0.1,
            stops: [0, 95, 100]
          },
           colors: [primaryColor]
        },
        colors: [primaryColor],
        series: [{
          name: seriesName,
          data: seriesData
        }],
        xaxis: {
          categories: categories,
          labels: {
             style: {
                // Tamanho ajustado via CSS
             }
          },
          axisBorder: { show: false },
          axisTicks: { show: false },
          tooltip: { enabled: false } // Desabilitar tooltip do eixo X
        },
        yaxis: {
          labels: {
            formatter: formatCurrency,
            style: {
                // Tamanho ajustado via CSS
            }
          }
        },
        tooltip: {
          theme: 'dark',
          y: {
            formatter: formatCurrency
          }
        },
        grid: {
          show: true,
          borderColor: gridColor,
          strokeDashArray: 3, // Linhas tracejadas mais curtas
          padding: { // Adiciona padding interno ao grid
            top: 5,
            right: 10,
            bottom: 0,
            left: 10
          },
          yaxis: { lines: { show: true } },
          xaxis: { lines: { show: false } }
        },
        theme: {
           mode: 'dark'
        },
         markers: { // Marcadores menores
            size: 3,
            colors: [primaryColor],
            strokeColors: cardBgColor,
            strokeWidth: 1,
            hover: {
                size: 5
            }
        },
        responsive: [
          {
            breakpoint: 1200, // xl
            options: { chart: { height: chartHeight * 0.95 } }
          },
          {
            breakpoint: 992, // lg
            options: { chart: { height: chartHeight * 0.9 } }
          },
          {
            breakpoint: 768, // md
            options: {
                chart: { height: chartHeight * 0.85 },
                stroke: { width: 2 }, // Largura normal da linha
                markers: { size: 3, hover: { size: 5 } }
             }
          },
          {
            breakpoint: 576, // sm/xs - Otimizações mobile mais agressivas
            options: {
                chart: { height: chartHeight * 0.75 }, // Ainda mais baixo
                markers: { size: 0, hover: { size: 0 } }, // Oculta marcadores
                yaxis: { labels: { show: false } }, // Oculta labels do eixo Y
                xaxis: { labels: { // Mostra menos labels no eixo X
                    show: true, // Mantém visível, mas com ajuste abaixo
                    // O CSS já ajusta a font-size
                    // Pode-se adicionar um `hideOverlappingLabels: true` se necessário
                    // Ou `trim: true`
                  }
                },
                grid: { // Menos padding no grid mobile
                   padding: { left: 0, right: 5 }
                }
            }
          }
        ]
      };
    }

    // ===================================================================
    // DADOS E RENDERIZAÇÃO INICIAL
    // ===================================================================
    const valorJaneiro = 5686819.08;
    const valorFevereiro = 6105182.26;
    const valorMarco = 6995663.47;
    const valorTotal = valorJaneiro + valorFevereiro + valorMarco;

    const dadosMensal = [valorJaneiro, valorFevereiro, valorMarco];
    const categoriasMensal = ['Jan', 'Fev', 'Mar']; // Abreviações para mobile

    const dadosSemanasJaneiro = [1059106.09, 1390876.49, 1356479.34, 1880357.16];
    const dadosSemanasFev = [1347844.70, 1351449.96, 1707533.26, 1698354.34];
    const dadosSemanasMarco = [1516175.78, 1634234.11, 1343905.08, 2501348.50];
    const categoriasSemanas = ['S1', 'S2', 'S3', 'S4']; // Abreviações para mobile

    // --- Define os KPIs ---
    document.getElementById('kpi-total-geral').textContent = formatCurrency(valorTotal);
    document.getElementById('kpi-janeiro').textContent = formatCurrency(valorJaneiro);
    document.getElementById('kpi-fevereiro').textContent = formatCurrency(valorFevereiro);
    document.getElementById('kpi-marco').textContent = formatCurrency(valorMarco);

    // --- Renderiza Gráfico Mensal ---
    // Usar categorias abreviadas e altura base ligeiramente menor
    const optionsMensal = createAreaChartOptions('chartMensal', dadosMensal, categoriasMensal, 'Gasto Mensal', 340);
    const chartMensal = new ApexCharts(document.querySelector("#chartMensal"), optionsMensal);
    chartMensal.render();

    // --- Renderiza Gráfico Semanal Janeiro ---
    // Usar categorias abreviadas e altura base menor
    const optionsSemanalJaneiro = createAreaChartOptions('chartSemanalJaneiro', dadosSemanasJaneiro, categoriasSemanas, 'Gasto Semanal', 260);
    const chartSemanalJaneiro = new ApexCharts(document.querySelector("#chartSemanalJaneiro"), optionsSemanalJaneiro);
    chartSemanalJaneiro.render();

    // --- Renderiza Gráfico Semanal Fevereiro ---
    const optionsSemanalFev = createAreaChartOptions('chartSemanalFevereiro', dadosSemanasFev, categoriasSemanas, 'Gasto Semanal', 260);
    const chartSemanalFev = new ApexCharts(document.querySelector("#chartSemanalFevereiro"), optionsSemanalFev);
    chartSemanalFev.render();

    // --- Renderiza Gráfico Semanal Março ---
    const optionsSemanalMarco = createAreaChartOptions('chartSemanalMarco', dadosSemanasMarco, categoriasSemanas, 'Gasto Semanal', 260);
    const chartSemanalMarco = new ApexCharts(document.querySelector("#chartSemanalMarco"), optionsSemanalMarco);
    chartSemanalMarco.render();

  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>
</html>
