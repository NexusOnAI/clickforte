<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>ClickForte | Financeiro (Novo Dark)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <style>
    html, body { margin: 0; padding: 0; min-height: -webkit-fill-available; -webkit-text-size-adjust: 100%; -webkit-overflow-scrolling: touch; overscroll-behavior-y: contain; font-family: Inter, sans-serif; color-scheme: dark; }
    body {
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
        background-color: #1a1d21;
        color: #e9ecef;
    }
    #profileHeader {
        padding-top: calc(env(safe-area-inset-top) + 0.75rem);
        padding-bottom: 0.75rem;
        position: sticky; top: 0; z-index: 30;
        background-color: rgba(26, 29, 33, 0.85);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-bottom: 1px solid #495057;
    }
     #desktopTopBar {
        padding-top: env(safe-area-inset-top);
        height: calc(4rem + env(safe-area-inset-top));
        position: sticky; /* Make sure it's sticky */
        top: 0; /* Stick to top */
        z-index: 20; /* Lower z-index than sidebar */
    }
     #desktopSidebar {
         height: 100vh; /* Full viewport height */
         top: 0; /* Align to top */
         position: sticky; /* Stick to the viewport */
         z-index: 30; /* Higher z-index than header */
         transition: width 0.3s ease-in-out; /* Keep width transition */
         width: 16rem; /* Default expanded width */
         flex-shrink: 0;
     }
     #mainContent {
         flex: 1;
         min-width: 0;
         height: 100vh; /* Full viewport height */
         overflow-y: auto; /* Scroll within main content */
         /* Add padding top ONLY on desktop to account for the header height */
         padding-top: 0; /* Default no padding */
     }
     /* Apply padding-top to mainContent only on medium screens and up */
     @media (min-width: 768px) {
        #mainContent {
            padding-top: calc(4rem + env(safe-area-inset-top));
        }
     }


    html { height: -webkit-fill-available; scroll-behavior: smooth; }
    @media (max-width: 768px) {
        .h-screen { height: calc(var(--vh, 1vh) * 100); }
        /* Sidebar should behave normally on mobile (covered by mobileSidebar anyway) */
        #desktopSidebar { height: auto; top: auto; position: static; z-index: auto; }
        /* Main content takes full height on mobile */
        #mainContent { height: 100%; padding-top: 0; }
    }

    iframe { box-shadow: none; background-color: #1a1d21; border: none; width: 100%; height: 100%; display: block; }

    :focus-visible { outline: 2px solid rgb(77 171 247 / 0.5); outline-offset: 2px; }
    button:focus, a:focus, input:focus { outline: none; }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-thumb { background-color: #495057; border-radius: 9999px; border: 2px solid #212529; }
    ::-webkit-scrollbar-track { background-color: #343a40; border-radius: 9999px; }


    #welcomeScreen { position: fixed; inset: 0; background: #1a1d21; z-index: 70; display: none; align-items: center; justify-content: center; flex-direction: column; opacity: 0; transition: opacity 0.5s ease-in-out; }
    #welcomeScreen.visible { display: flex; opacity: 1; }

    .nav-link.active,
    #integrationBtnHeader.active,
    #integrationBtnDesktop.active {
        background-color: rgba(77, 171, 247, 0.15);
        color: #4dabf7;
        font-weight: 500;
    }
    #desktopSidebar:not(.sidebar-collapsed) .nav-link.active {
        border-left: 4px solid #4dabf7;
        padding-left: calc(0.625rem + 4px);
    }
    #desktopSidebar.sidebar-collapsed .nav-link.active {
        border-left: none;
        padding-left: 0.75rem;
    }
    #mobileSidebar .nav-link.active {
         border-left: 4px solid #4dabf7;
         padding-left: calc(0.75rem - 4px);
    }

    .nav-link.active i:not(.submenu-toggle-icon),
    #integrationBtnHeader.active i,
    #integrationBtnDesktop.active i {
      color: #4dabf7;
    }

    .submenu .nav-link.active {
        border-left: none; padding-left: 0.5rem;
        background-color: rgba(77, 171, 247, 0.1);
        color: #e9ecef;
    }
    #desktopSidebar:not(.sidebar-collapsed) .submenu .nav-link.active {
        padding-left: 0.5rem;
    }
    #desktopSidebar.sidebar-collapsed .submenu .nav-link {
        padding-left: 0.5rem; padding-right: 0.5rem; justify-content: center;
    }
     #mobileSidebar .submenu .nav-link.active {
         padding-left: 0.5rem;
     }
    .submenu .nav-link.active i { color: inherit; }

    .profile-trigger.active img {
         box-shadow: 0 0 0 3px rgba(77, 171, 247, 0.5);
    }

    .submenu { max-height: 0; overflow: hidden; transition: max-height 0.35s ease-out; }
    .submenu-visible { max-height: 500px; }

    @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-3px, 0, 0); } 40%, 60% { transform: translate3d(3px, 0, 0); } }
    .animate-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }

    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .text-xs\+ { font-size: 0.8125rem; line-height: 1.25rem; }

    #iframeSpinnerOverlay > div {
        border-color: #4dabf7;
        border-bottom-color: transparent;
    }

    #desktopSidebar.sidebar-collapsed {
        width: 5rem;
    }

    #desktopSidebar.sidebar-collapsed .sidebar-text,
    #desktopSidebar.sidebar-collapsed .sidebar-logo-full,
    #desktopSidebar.sidebar-collapsed .submenu-toggle-icon,
    #desktopSidebar.sidebar-collapsed .submenu {
        display: none;
    }
    #desktopSidebar.sidebar-collapsed .nav-link i:not(.submenu-toggle-icon) {
        margin-right: 0;
    }
    #desktopSidebar.sidebar-collapsed .nav-link {
        justify-content: center;
    }
    /* Remove collapsed styles for the deleted profile section */
    /* #desktopSidebar.sidebar-collapsed .profile-section-bottom { ... } */
    /* #desktopSidebar.sidebar-collapsed .profile-section-bottom > div:first-child { ... } */
    /* #desktopSidebar.sidebar-collapsed #sidebarProfileImg { ... } */

    #desktopSidebar.sidebar-collapsed .logo-container {
        height: 60px; justify-content: center;
    }
    #desktopSidebar.sidebar-collapsed #desktopSidebarToggle button {
        justify-content: center;
    }
    #desktopSidebar .overflow-y-auto {
        overflow-y: auto;
    }
  </style>
  </head>
<body class="min-h-screen antialiased">

  <div id="loginOverlay" class="fixed inset-0 flex items-center justify-center p-4 z-50 bg-[#1a1d21]/80 backdrop-blur-sm">
     <div class="bg-[#212529] rounded-lg shadow-xl w-full max-w-md p-8 border border-[#495057]">
      <div class="text-center mb-8">
        <img src="https://war-machine.s3.sa-east-1.amazonaws.com/seller/521/logo/96169866-logo-alta-2552x1080.png" alt="Logo ClickForte" class="mx-auto h-12 w-auto" />
      </div>
      <h2 class="text-center text-2xl font-semibold text-[#e9ecef] mb-2">Bem-vindo de volta!</h2>
      <p class="text-center text-[#adb5bd] text-sm mb-6">Faça login para acessar seu painel.</p>
      <div id="logoutNotification" class="hidden mb-4 p-3 text-sm text-yellow-300 bg-yellow-900/30 border border-yellow-700/50 rounded-md text-center">Você foi desconectado!</div>
      <div id="loginError" class="hidden mb-4 p-3 text-sm text-red-300 bg-red-900/30 border border-red-700/50 rounded-md text-center"></div>
      <form id="formLogin" novalidate class="space-y-5">
        <div>
          <label for="username" class="block text-[#e9ecef] mb-1.5 text-sm font-medium">Usuário</label>
          <input type="text" id="username" placeholder="Digite seu usuário" required
                 class="w-full px-4 py-2.5 bg-[#343a40] border border-[#495057] rounded-md text-[#e9ecef] focus:ring-2 focus:ring-[#4dabf7] focus:border-[#4dabf7] transition duration-200 placeholder-[#adb5bd]" />
        </div>
        <div>
          <label for="password" class="block text-[#e9ecef] mb-1.5 text-sm font-medium">Senha</label>
          <div class="relative">
            <input type="password" id="password" placeholder="Digite sua senha" required
                   class="w-full px-4 py-2.5 bg-[#343a40] border border-[#495057] rounded-md text-[#e9ecef] focus:ring-2 focus:ring-[#4dabf7] focus:border-[#4dabf7] transition duration-200 pr-10 placeholder-[#adb5bd]" />
            <button type="button" id="togglePassword" class="absolute inset-y-0 right-0 px-3 flex items-center text-[#adb5bd] hover:text-[#e9ecef]" aria-label="Mostrar senha">
              <i class="bi bi-eye-slash text-lg"></i>
            </button>
          </div>
        </div>
        <div class="flex items-center justify-between text-sm">
          <div class="flex items-center">
            <input type="checkbox" id="rememberMe"
                   class="h-4 w-4 text-[#4dabf7] focus:ring-[#4dabf7] border-[#495057] rounded bg-[#343a40] focus:ring-offset-[#1a1d21]" />
            <label for="rememberMe" class="ml-2 block text-[#adb5bd]">Lembrar meus dados</label>
          </div>
          <a href="#" class="font-medium text-[#4dabf7] hover:text-[#63bfff]">Esqueceu a senha?</a>
        </div>
        <button type="submit" id="loginButton"
                class="w-full py-3 px-4 rounded-md font-semibold text-[#1a1d21] bg-[#4dabf7] hover:bg-[#369aea] shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[#1a1d21] focus:ring-[#4dabf7] transition duration-200 disabled:opacity-60 disabled:cursor-not-allowed">
          <span class="button-text">Entrar</span>
          <span class="spinner-icon hidden ml-2"><i class="bi bi-arrow-repeat animate-spin"></i></span>
        </button>
      </form>
    </div>
  </div>

  <div id="welcomeScreen" class="fixed inset-0 bg-[#1a1d21] z-70 hidden items-center justify-center flex-direction-column opacity-0 transition-opacity duration-500 ease-in-out">
     <div class="text-center">
       <img src="https://war-machine.s3.sa-east-1.amazonaws.com/seller/521/logo/96169866-logo-alta-2552x1080.png" alt="Logo ClickForte" class="mx-auto h-16 w-auto mb-6 animate-pulse" />
       <h2 class="text-2xl font-semibold text-[#e9ecef] mb-2">Bem-vindo(a)!</h2>
       <p class="text-[#adb5bd]" id="welcomeUserName">Carregando seu painel...</p>
     </div>
  </div>

  <div id="dashboard" class="hidden flex flex-col min-h-screen">

    <header id="profileHeader" class="md:hidden flex justify-between items-center px-4 shadow-sm">
      <button id="mobileMenuBtn" onclick="toggleMobileSidebar()" class="p-2 -ml-2 text-[#adb5bd] hover:text-[#4dabf7] hover:bg-[#343a40] rounded-full" aria-label="Abrir menu">
        <i class="bi bi-list text-xl"></i>
      </button>
      <div class="flex items-center">
          <button id="integrationBtnHeader"
                  class="p-2 text-[#adb5bd] hover:text-[#4dabf7] hover:bg-[#343a40] rounded-full transition-colors duration-150 mr-2"
                  aria-label="Integração"
                  onclick="loadPage('integracao.html', this); return false;">
              <i class="bi bi-link-45deg text-xl"></i>
          </button>
          <div class="flex items-center cursor-pointer group profile-trigger" onclick="openProfileModal()">
              <span id="profileNameHeader" class="font-medium mr-2 hidden sm:inline text-[#e9ecef] group-hover:text-[#4dabf7] transition-colors duration-150">Nome do Usuário</span>
              <img id="profileImgHeader" src="https://via.placeholder.com/40" alt="Perfil" class="w-8 h-8 rounded-full object-cover ring-2 ring-offset-2 ring-offset-[#1a1d21] ring-[#4dabf7] group-hover:ring-[#63bfff] transition-all duration-150" />
          </div>
      </div>
    </header>

    <header id="desktopTopBar" class="hidden md:flex items-center justify-end px-6 bg-[#212529] border-b border-[#495057]">
        <div class="flex items-center gap-4">
            <button id="integrationBtnDesktop"
                    class="p-2 text-[#adb5bd] hover:text-[#4dabf7] hover:bg-[#343a40] rounded-full transition-colors duration-150"
                    aria-label="Integração"
                    onclick="loadPage('integracao.html', this); return false;">
                <i class="bi bi-link-45deg text-xl"></i>
            </button>
            <div class="h-6 w-px bg-[#495057]"></div>
            <div class="flex items-center gap-3 cursor-pointer group profile-trigger" onclick="openProfileModal()">
                <span id="profileNameDesktop" class="font-medium text-sm text-[#e9ecef] group-hover:text-[#4dabf7] transition-colors duration-150">Nome do Usuário</span>
                <img id="profileImgDesktop" src="https://via.placeholder.com/40" alt="Perfil" class="w-9 h-9 rounded-full object-cover ring-2 ring-offset-2 ring-offset-[#1a1d21] ring-[#4dabf7] group-hover:ring-[#63bfff] transition-all duration-150" />
            </div>
            <button onclick="logout(); event.stopPropagation();" class="text-[#adb5bd] hover:text-red-500 hover:bg-red-900/30 p-2 rounded-full transition-colors duration-150" aria-label="Sair">
              <i class="bi bi-box-arrow-right text-lg"></i>
            </button>
        </div>
    </header>

    <div class="flex flex-1 relative"> {/* Container wrapper needs to allow overlap - relative positioning might help */}

      <nav id="desktopSidebar" class="hidden md:flex flex-col bg-[#212529] text-[#adb5bd] shadow-md border-r border-[#495057]">
        <div id="sidebarLogoContainer" class="logo-container p-5 flex flex-col items-center border-b border-[#495057] h-[60px] justify-center flex-shrink-0">
          <img src="https://war-machine.s3.sa-east-1.amazonaws.com/seller/521/logo/96169866-logo-alta-2552x1080.png" alt="Logo ClickForte" class="sidebar-logo-full mx-auto h-9 w-auto" />
        </div>

        <div class="overflow-y-auto flex-grow p-3 space-y-1">
          <a href="#" onclick="loadPage('home.html', this); return false;" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef]">
            <i class="bi bi-house-door-fill w-5 text-center text-lg"></i>
            <span class="sidebar-text text-sm font-medium">Home</span>
          </a>
          <a href="#" onclick="loadPage('integracao.html', this); return false;" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef]">
            <i class="bi bi-arrows-angle-contract w-5 text-center text-lg"></i>
            <span class="sidebar-text text-sm font-medium">Integração</span>
          </a>
           <div class="nav-item">
            <button onclick="toggleSubmenu('desktopPrevisaoSubmenu', 'desktopPrevisaoIcon')" class="nav-link flex items-center justify-between gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef] w-full text-left">
              <span class="flex items-center gap-3">
                <i class="bi bi-calendar-event-fill w-5 text-center text-lg"></i>
                <span class="sidebar-text text-sm font-medium">Previsão</span>
              </span>
              <i id="desktopPrevisaoIcon" class="submenu-toggle-icon bi bi-chevron-down text-xs transition-transform duration-300"></i>
            </button>
            <div id="desktopPrevisaoSubmenu" class="submenu pl-6 ml-4 mt-1 space-y-0.5 border-l border-[#495057]">
              <a href="#" onclick="loadPage('previsao_abril.html', this); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Abril</a>
              </div>
          </div>
           <div class="nav-item">
              <button onclick="toggleSubmenu('desktopGastosSubmenu', 'desktopGastosIcon')" class="nav-link flex items-center justify-between gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef] w-full text-left">
                <span class="flex items-center gap-3">
                  <i class="bi bi-wallet2 w-5 text-center text-lg"></i>
                  <span class="sidebar-text text-sm font-medium">Gastos</span>
                </span>
                <i id="desktopGastosIcon" class="submenu-toggle-icon bi bi-chevron-down text-xs transition-transform duration-300"></i>
              </button>
              <div id="desktopGastosSubmenu" class="submenu pl-6 ml-4 mt-1 space-y-0.5 border-l border-[#495057]">
               <a href="#" onclick="loadPage('sub_janeiro.html', this); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Janeiro</a>
               <a href="#" onclick="loadPage('sub_fevereiro.html', this); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Fevereiro</a>
               <a href="#" onclick="loadPage('sub_marco.html', this); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Março</a>
               <a href="#" onclick="loadPage('sub_abril.html', this); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Abril</a>
               </div>
          </div>
          <a href="#" onclick="loadPage('geral.html', this); return false;" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef]">
            <i class="bi bi-graph-up w-5 text-center text-lg"></i>
            <span class="sidebar-text text-sm font-medium">Relatório Geral</span>
          </a>
          <div class="nav-item">
            <button onclick="toggleSubmenu('desktopConfigSubmenu', 'desktopConfigIcon')" class="nav-link flex items-center justify-between gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef] w-full text-left">
              <span class="flex items-center gap-3">
                <i class="bi bi-gear-fill w-5 text-center text-lg"></i>
                <span class="sidebar-text text-sm font-medium">Configurações</span>
              </span>
              <i id="desktopConfigIcon" class="submenu-toggle-icon bi bi-chevron-down text-xs transition-transform duration-300"></i>
            </button>
            <div id="desktopConfigSubmenu" class="submenu pl-6 ml-4 mt-1 space-y-0.5 border-l border-[#495057]">
              <a href="#" onclick="openProfileModal(); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef] profile-sidebar-link">
                <i class="bi bi-person-circle w-5 text-center text-base mr-1 -ml-1"></i> Perfil
              </a>
              </div>
          </div>
        </div>

        <div id="desktopSidebarToggle" class="p-3 border-t border-[#495057] flex-shrink-0">
           <button onclick="toggleDesktopSidebar()" class="flex items-center gap-3 w-full px-3 py-2.5 rounded-md text-[#adb5bd] hover:bg-[#343a40] hover:text-[#e9ecef] transition-colors duration-150" aria-label="Recolher barra lateral">
               <i id="desktopToggleIcon" class="bi bi-chevron-double-left w-5 text-center text-lg"></i>
               <span class="sidebar-text text-sm font-medium">Recolher</span>
           </button>
        </div>

        </nav>

      <main id="mainContent" class="p-4 md:p-6 relative bg-[#1a1d21]">
        <div id="iframeSpinnerOverlay" class="absolute inset-0 bg-[#1a1d21]/60 backdrop-blur-sm z-20 hidden items-center justify-center rounded-lg">
         <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#4dabf7]"></div>
        </div>
        <iframe id="mainFrame" src="home.html" class="w-full h-full rounded-lg shadow-md relative z-10 border border-[#495057]" title="Conteúdo Principal"></iframe>
      </main>
    </div>

    <div id="mobileSidebarWrapper" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden" onclick="toggleMobileSidebar()"></div>
    <nav id="mobileSidebar" class="fixed top-0 left-0 bottom-0 w-64 bg-[#212529] text-[#adb5bd] h-screen flex flex-col shadow-xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden border-r border-[#495057]">
        <div class="p-4 flex justify-between items-center border-b border-[#495057] h-[60px]">
         <img src="https://war-machine.s3.sa-east-1.amazonaws.com/seller/521/logo/96169866-logo-alta-2552x1080.png" alt="Logo ClickForte" class="max-h-7 w-auto" />
         <button onclick="toggleMobileSidebar()" class="p-2 -mr-2 text-[#adb5bd] hover:text-[#4dabf7] hover:bg-[#343a40] rounded-full" aria-label="Fechar menu">
           <i class="bi bi-x-lg text-xl"></i>
         </button>
        </div>
        <div class="overflow-y-auto flex-grow p-3 space-y-1">
         <a href="#" onclick="loadPage('home.html', this); toggleMobileSidebar(); return false;" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef]"> <i class="bi bi-house-door-fill w-5 text-center text-lg"></i> <span class="text-sm font-medium">Home</span></a>
         <a href="#" onclick="loadPage('integracao.html', this); toggleMobileSidebar(); return false;" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef]"> <i class="bi bi-arrows-angle-contract w-5 text-center text-lg"></i> <span class="text-sm font-medium">Integração</span></a>
           <div class="nav-item">
           <button onclick="toggleSubmenu('mobilePrevisaoSubmenu', 'mobilePrevisaoIcon')" class="nav-link flex items-center justify-between gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef] w-full text-left">
             <span class="flex items-center gap-3"><i class="bi bi-calendar-event-fill w-5 text-center text-lg"></i> <span class="text-sm font-medium">Previsão</span></span>
             <i id="mobilePrevisaoIcon" class="bi bi-chevron-down text-xs transition-transform duration-300"></i>
           </button>
           <div id="mobilePrevisaoSubmenu" class="submenu pl-6 ml-4 mt-1 space-y-0.5 border-l border-[#495057]">
             <a href="#" onclick="loadPage('previsao_abril.html', this); toggleMobileSidebar(); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Abril</a>
             <a href="#" onclick="loadPage('previsao_maio.html', this); toggleMobileSidebar(); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Maio</a>
             <a href="#" onclick="loadPage('previsao_dezembro.html', this); toggleMobileSidebar(); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Dezembro</a>
           </div>
         </div>
          <div class="nav-item">
           <button onclick="toggleSubmenu('mobileGastosSubmenu', 'mobileGastosIcon')" class="nav-link flex items-center justify-between gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef] w-full text-left">
             <span class="flex items-center gap-3"><i class="bi bi-wallet2 w-5 text-center text-lg"></i> <span class="text-sm font-medium">Gastos</span></span>
             <i id="mobileGastosIcon" class="bi bi-chevron-down text-xs transition-transform duration-300"></i>
           </button>
           <div id="mobileGastosSubmenu" class="submenu pl-6 ml-4 mt-1 space-y-0.5 border-l border-[#495057]">
             <a href="#" onclick="loadPage('sub_janeiro.html', this); toggleMobileSidebar(); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Janeiro</a>
             <a href="#" onclick="loadPage('sub_fevereiro.html', this); toggleMobileSidebar(); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Fevereiro</a>
             <a href="#" onclick="loadPage('sub_marco.html', this); toggleMobileSidebar(); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Março</a>
             <a href="#" onclick="loadPage('sub_abril.html', this); toggleMobileSidebar(); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Abril</a>
           </div>
          </div>
         <a href="#" onclick="loadPage('geral.html', this); toggleMobileSidebar(); return false;" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef]"> <i class="bi bi-graph-up w-5 text-center text-lg"></i> <span class="text-sm font-medium">Relatório Geral</span></a>
           <div class="nav-item">
            <button onclick="toggleSubmenu('mobileConfigSubmenu', 'mobileConfigIcon')" class="nav-link flex items-center justify-between gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef] w-full text-left">
              <span class="flex items-center gap-3"><i class="bi bi-gear-fill w-5 text-center text-lg"></i> <span class="text-sm font-medium">Configurações</span></span>
              <i id="mobileConfigIcon" class="bi bi-chevron-down text-xs transition-transform duration-300"></i>
            </button>
            <div id="mobileConfigSubmenu" class="submenu pl-6 ml-4 mt-1 space-y-0.5 border-l border-[#495057]">
              <a href="#" onclick="openProfileModal(); toggleMobileSidebar(); return false;" class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef] profile-sidebar-link">
                 <i class="bi bi-person-circle w-5 text-center text-base mr-1 -ml-1"></i> Perfil
              </a>
              </div>
          </div>
          </div>
        <div class="p-3 mt-auto border-t border-[#495057]">
         <button onclick="logout()" class="w-full flex items-center justify-center gap-2 px-3 py-2.5 rounded-md text-red-400 bg-red-900/20 hover:bg-red-900/40 hover:text-red-300 transition-colors duration-150 text-sm font-medium">
           <i class="bi bi-box-arrow-left"></i> <span>Sair</span>
         </button>
        </div>
       </nav>
  </div>

  <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm hidden items-center justify-center z-50 p-4 transition-opacity duration-200 ease-in-out">
     <div class="bg-[#212529] rounded-lg w-full max-w-lg p-6 shadow-xl text-[#e9ecef] transform transition-all duration-200 ease-in-out scale-95 opacity-0 border border-[#495057]" id="profileModalContent">
      <form id="profileForm">
        <div class="flex justify-between items-start border-b border-[#495057] pb-3 mb-5">
          <h5 class="text-lg font-semibold text-[#e9ecef]">Editar Perfil</h5>
          <button type="button" onclick="closeProfileModal()" class="text-[#adb5bd] hover:text-[#e9ecef] hover:bg-[#343a40] rounded-full p-1.5 -mt-1 -mr-1" aria-label="Fechar modal">
            <i class="bi bi-x-lg text-xl"></i>
          </button>
        </div>
        <div class="flex flex-col sm:flex-row items-center sm:items-start gap-6 mb-6">
          <div class="flex-shrink-0 text-center">
            <img id="modalProfileImg" src="https://via.placeholder.com/100" alt="Foto de Perfil" class="mx-auto rounded-full w-24 h-24 object-cover ring-2 ring-offset-2 ring-offset-[#1a1d21] ring-[#4dabf7] mb-3" />
            <label for="profilePicInput" class="cursor-pointer text-xs text-[#4dabf7] hover:text-[#63bfff] font-medium px-3 py-1.5 rounded-md bg-[#4dabf7]/20 hover:bg-[#4dabf7]/30 transition-colors duration-150 inline-block">
              <i class="bi bi-upload mr-1"></i> Alterar foto
              <input type="file" id="profilePicInput" accept="image/*" class="hidden" />
            </label>
          </div>
          <div class="w-full flex-grow space-y-4">
             <div>
               <label for="profileNameInput" class="block text-[#e9ecef] mb-1.5 text-sm font-medium">Nome de Usuário</label>
               <input type="text" id="profileNameInput" placeholder="Digite seu nome" required
                      class="w-full px-4 py-2.5 bg-[#343a40] border border-[#495057] rounded-md text-[#e9ecef] focus:ring-2 focus:ring-[#4dabf7] focus:border-[#4dabf7] transition duration-200 placeholder-[#adb5bd]" />
             </div>
          </div>
        </div>
        <div class="space-y-4 border-t border-[#495057] pt-6 mb-6">
            <h6 class="text-md font-semibold text-[#adb5bd]">Alterar Senha</h6>
            <div>
                <label for="currentPassword" class="block text-[#e9ecef] mb-1.5 text-sm font-medium">Senha Atual</label>
                <input type="password" id="currentPassword" placeholder="Digite sua senha atual"
                       class="w-full px-4 py-2.5 bg-[#343a40] border border-[#495057] rounded-md text-[#e9ecef] focus:ring-2 focus:ring-[#4dabf7] focus:border-[#4dabf7] transition duration-200 placeholder-[#adb5bd]" />
            </div>
             <div>
                <label for="newPassword" class="block text-[#e9ecef] mb-1.5 text-sm font-medium">Nova Senha</label>
                <input type="password" id="newPassword" placeholder="Digite a nova senha"
                       class="w-full px-4 py-2.5 bg-[#343a40] border border-[#495057] rounded-md text-[#e9ecef] focus:ring-2 focus:ring-[#4dabf7] focus:border-[#4dabf7] transition duration-200 placeholder-[#adb5bd]" />
            </div>
             <div>
                <label for="confirmPassword" class="block text-[#e9ecef] mb-1.5 text-sm font-medium">Confirmar Nova Senha</label>
                <input type="password" id="confirmPassword" placeholder="Confirme a nova senha"
                       class="w-full px-4 py-2.5 bg-[#343a40] border border-[#495057] rounded-md text-[#e9ecef] focus:ring-2 focus:ring-[#4dabf7] focus:border-[#4dabf7] transition duration-200 placeholder-[#adb5bd]" />
            </div>
        </div>
        <div class="flex justify-end space-x-3 pt-4 border-t border-[#495057]">
          <button type="button" onclick="closeProfileModal()" class="px-4 py-2 bg-[#343a40] text-[#e9ecef] rounded-md hover:bg-[#495057] border border-[#495057] transition duration-150 text-sm font-medium">Cancelar</button>
          <button type="submit" class="px-4 py-2 bg-[#4dabf7] text-[#1a1d21] rounded-md hover:bg-[#369aea] transition duration-150 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[#1a1d21] focus:ring-[#4dabf7] text-sm font-medium">Salvar Alterações</button>
        </div>
       </form>
     </div>
  </div>


  <script>
    function setVhProperty() {
      let vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    setVhProperty();
    window.addEventListener('resize', setVhProperty);
    window.addEventListener('orientationchange', setVhProperty);
  </script>

  <script>
     const loginOverlay = document.getElementById('loginOverlay');
     const loginErrorDiv = document.getElementById('loginError');
     const formLogin = document.getElementById('formLogin');
     const usernameField = document.getElementById('username');
     const passwordField = document.getElementById('password');
     const rememberMe = document.getElementById('rememberMe');
     const loginButton = document.getElementById('loginButton');
     const buttonText = loginButton.querySelector('.button-text');
     const spinnerIcon = loginButton.querySelector('.spinner-icon');
     const togglePasswordButton = document.getElementById('togglePassword');
     const welcomeScreen = document.getElementById('welcomeScreen');
     const welcomeUserName = document.getElementById('welcomeUserName');
     const dashboard = document.getElementById('dashboard');
     const mainFrame = document.getElementById('mainFrame');
     const iframeSpinnerOverlay = document.getElementById('iframeSpinnerOverlay');
     const logoutNotification = document.getElementById('logoutNotification');

     const mobileSidebarWrapper = document.getElementById('mobileSidebarWrapper');
     const mobileSidebar = document.getElementById('mobileSidebar');
     const profileHeaderMobile = document.getElementById('profileHeader');
     const integrationBtnHeaderMobile = document.getElementById('integrationBtnHeader');
     const profileNameHeaderMobile = document.getElementById('profileNameHeader');
     const profileImgHeaderMobile = document.getElementById('profileImgHeader');

     const desktopTopBar = document.getElementById('desktopTopBar');
     const integrationBtnDesktop = document.getElementById('integrationBtnDesktop');
     const profileNameDesktop = document.getElementById('profileNameDesktop');
     const profileImgDesktop = document.getElementById('profileImgDesktop');
     const desktopSidebar = document.getElementById('desktopSidebar');
     const mainContent = document.getElementById('mainContent');
     const desktopSidebarToggleBtn = document.getElementById('desktopSidebarToggle')?.querySelector('button');
     const desktopToggleIcon = document.getElementById('desktopToggleIcon');
     const desktopToggleText = desktopSidebarToggleBtn?.querySelector('.sidebar-text');

     const profileModal = document.getElementById('profileModal');
     const profileModalContent = document.getElementById('profileModalContent');
     const profileForm = document.getElementById('profileForm');
     const profileNameInput = document.getElementById('profileNameInput');
     const profilePicInput = document.getElementById('profilePicInput');
     const modalProfileImg = document.getElementById('modalProfileImg');

     // Sidebar Profile elements removed from references as the section is gone
     // const sidebarProfileImg = document.getElementById('sidebarProfileImg');
     // const sidebarProfileName = document.getElementById('sidebarProfileName');

     const sidebarIntegrationLinkDesktop = document.querySelector('#desktopSidebar .nav-link[onclick*="integracao.html"]');
     const sidebarIntegrationLinkMobile = document.querySelector('#mobileSidebar .nav-link[onclick*="integracao.html"]');
     const sidebarProfileLinkDesktop = document.querySelector('#desktopSidebar .profile-sidebar-link');
     const sidebarProfileLinkMobile = document.querySelector('#mobileSidebar .profile-sidebar-link');

     const profileTriggers = document.querySelectorAll('.profile-trigger');

     const DEFAULT_PROFILE_PIC_SMALL = 'https://via.placeholder.com/40';
     const DEFAULT_PROFILE_PIC_MEDIUM = 'https://via.placeholder.com/40';
     const DEFAULT_PROFILE_PIC_LARGE = 'https://via.placeholder.com/100';

     function showElement(el) { if (el) el.classList.remove('hidden'); }
     function hideElement(el) { if (el) el.classList.add('hidden'); }
     function showFlexElement(el) { if (el) { el.classList.remove('hidden'); el.classList.add('flex'); } }
     function hideFlexElement(el) { if (el) { el.classList.remove('flex'); el.classList.add('hidden'); } }
     function disableButton(btn, textEl, spinnerEl) { if(btn) btn.disabled = true; if(textEl) textEl.classList.add('hidden'); if(spinnerEl) spinnerEl.classList.remove('hidden'); }
     function enableButton(btn, textEl, spinnerEl) { if(btn) btn.disabled = false; if(textEl) textEl.classList.remove('hidden'); if(spinnerEl) spinnerEl.classList.add('hidden'); }

     formLogin.addEventListener('submit', function (e) {
       e.preventDefault();
       hideElement(loginErrorDiv);
       disableButton(loginButton, buttonText, spinnerIcon);
       setTimeout(() => {
        const validUsername = localStorage.getItem('savedUsername') || 'admin';
        const username = usernameField.value.trim();
        const password = passwordField.value;
        if (username === validUsername && password === 'admin123') {
         handleSuccessfulLogin(username, password);
        } else {
         handleFailedLogin();
        }
       }, 1000);
     });

     function handleSuccessfulLogin(username, password) {
       if (rememberMe.checked) {
        localStorage.setItem('savedUsername', username);
        localStorage.setItem('savedPassword', password);
       } else {
        localStorage.removeItem('savedPassword');
        localStorage.setItem('savedUsername', username);
       }
       localStorage.setItem('isLoggedIn', 'true');

       hideFlexElement(loginOverlay);
       welcomeUserName.textContent = `Olá, ${username}! Carregando seu painel...`;
       welcomeScreen.classList.add('visible');

       setTimeout(() => {
        welcomeScreen.classList.remove('visible');
        setTimeout(() => { hideElement(welcomeScreen); }, 500);

        showFlexElement(dashboard);
        updateUserInfo();
        applyDesktopSidebarState();

        const homeLink = document.querySelector('#desktopSidebar .nav-link[onclick*="home.html"]') || document.querySelector('#mobileSidebar .nav-link[onclick*="home.html"]');
        if (homeLink) {
           loadPage('home.html', homeLink);
        } else {
           if (mainFrame) mainFrame.src = 'home.html';
           hideFlexElement(iframeSpinnerOverlay);
           console.warn("Home link not found.");
        }
        enableButton(loginButton, buttonText, spinnerIcon);
       }, 2000);
     }

     function handleFailedLogin() {
       loginErrorDiv.textContent = 'Usuário ou senha incorretos.';
       showElement(loginErrorDiv);
       enableButton(loginButton, buttonText, spinnerIcon);
       const loginCard = loginOverlay.querySelector('.bg-\\[\\#212529\\]');
       if(loginCard) {
           loginCard.classList.add('animate-shake');
           setTimeout(() => { loginCard.classList.remove('animate-shake'); }, 500);
       }
     }

     togglePasswordButton.addEventListener('click', function() {
       const icon = this.querySelector('i');
       if (passwordField.type === 'password') {
        passwordField.type = 'text'; icon.classList.replace('bi-eye-slash', 'bi-eye'); this.setAttribute('aria-label', 'Ocultar senha');
       } else {
        passwordField.type = 'password'; icon.classList.replace('bi-eye', 'bi-eye-slash'); this.setAttribute('aria-label', 'Mostrar senha');
       }
     });

     function logout() {
       localStorage.removeItem('isLoggedIn');

       hideFlexElement(dashboard);
       showFlexElement(loginOverlay);
       showElement(logoutNotification);
       setTimeout(() => hideElement(logoutNotification), 4000);

       if (mobileSidebar.classList.contains('translate-x-0')) toggleMobileSidebar();

       passwordField.value = '';
       hideElement(loginErrorDiv);

       const savedUsername = localStorage.getItem('savedUsername');
       const savedPassword = localStorage.getItem('savedPassword');
       usernameField.value = savedUsername || '';
       rememberMe.checked = !!savedPassword;
       console.log(">>> Logged out. Login screen prepared.");
     }

     function setActiveLink(clickedLinkElement) {
        if (!clickedLinkElement) return;

        document.querySelectorAll('.nav-link, #integrationBtnHeader, #integrationBtnDesktop, .profile-trigger, .profile-sidebar-link').forEach(el => {
            el.classList.remove('active');
        });

        clickedLinkElement.classList.add('active');

        const isIntegration = clickedLinkElement.getAttribute('onclick')?.includes('integracao.html');
        const isProfileTrigger = clickedLinkElement.classList.contains('profile-trigger') || clickedLinkElement.classList.contains('profile-sidebar-link');

        if (isIntegration) {
            if (sidebarIntegrationLinkDesktop) sidebarIntegrationLinkDesktop.classList.add('active');
            if (sidebarIntegrationLinkMobile) sidebarIntegrationLinkMobile.classList.add('active');
            if (integrationBtnHeaderMobile) integrationBtnHeaderMobile.classList.add('active');
            if (integrationBtnDesktop) integrationBtnDesktop.classList.add('active');
        } else if (isProfileTrigger) {
             if (sidebarProfileLinkDesktop) sidebarProfileLinkDesktop.classList.add('active');
             if (sidebarProfileLinkMobile) sidebarProfileLinkMobile.classList.add('active');
             profileTriggers.forEach(trigger => trigger.classList.add('active'));
             const parentConfigButtonD = sidebarProfileLinkDesktop?.closest('.nav-item')?.querySelector('button.nav-link');
             const parentConfigButtonM = sidebarProfileLinkMobile?.closest('.nav-item')?.querySelector('button.nav-link');
             if(parentConfigButtonD) parentConfigButtonD.classList.add('active');
             if(parentConfigButtonM) parentConfigButtonM.classList.add('active');

        } else {
            const parentSubmenu = clickedLinkElement.closest('.submenu');
            if (parentSubmenu) {
                const parentButton = parentSubmenu.previousElementSibling;
                if (parentButton && parentButton.classList.contains('nav-link')) {
                    parentButton.classList.add('active');
                    const isDesktopSidebarCollapsed = desktopSidebar?.classList.contains('sidebar-collapsed');
                    const context = parentSubmenu.id.includes('desktop') ? 'desktop' : 'mobile';
                    if ((context === 'mobile' || !isDesktopSidebarCollapsed) && !parentSubmenu.classList.contains('submenu-visible') ) {
                        const parentIconId = parentButton.querySelector('i[id$="Icon"]')?.id;
                        if (parentIconId) toggleSubmenu(parentSubmenu.id, parentIconId);
                    }
                }
            }
        }
     }


     function loadPage(pageUrl, clickedLinkElement) {
         showFlexElement(iframeSpinnerOverlay);
         setActiveLink(clickedLinkElement);
         if(mainFrame) {
           mainFrame.src = pageUrl;
         } else {
           console.error("Elemento iframe 'mainFrame' não encontrado.");
           hideFlexElement(iframeSpinnerOverlay);
         }
     }

     if (mainFrame && iframeSpinnerOverlay) {
         mainFrame.addEventListener('load', () => hideFlexElement(iframeSpinnerOverlay));
         mainFrame.addEventListener('error', (e) => {
             console.error(`Falha ao carregar iframe: ${mainFrame.src}`, e);
             hideFlexElement(iframeSpinnerOverlay);
         });
     } else {
         console.error("Iframe ou spinner overlay não encontrado.");
     }


     function toggleMobileSidebar() {
       const isOpen = mobileSidebar.classList.contains('translate-x-0');
       if (isOpen) {
        mobileSidebar.classList.replace('translate-x-0', '-translate-x-full');
        hideElement(mobileSidebarWrapper);
       } else {
        mobileSidebar.classList.replace('-translate-x-full', 'translate-x-0');
        showElement(mobileSidebarWrapper);
       }
     }

     function toggleSubmenu(submenuId, iconId) {
       const submenu = document.getElementById(submenuId);
       const icon = document.getElementById(iconId);
       if (!submenu || !icon) return;

       const context = submenuId.includes('desktop') ? 'desktop' : 'mobile';
       const isDesktopSidebarCollapsed = desktopSidebar?.classList.contains('sidebar-collapsed');

       if (context === 'mobile' || !isDesktopSidebarCollapsed) {
           document.querySelectorAll(`.submenu[id*="${context}"]`).forEach(otherSubmenu => {
               if (otherSubmenu.id !== submenuId && otherSubmenu.classList.contains('submenu-visible')) {
                   otherSubmenu.classList.remove('submenu-visible');
                   const otherIcon = document.getElementById(otherSubmenu.id.replace('Submenu', 'Icon'));
                   if (otherIcon) otherIcon.classList.remove('rotate-180');
               }
           });
       }

       if (context === 'mobile' || !isDesktopSidebarCollapsed) {
           submenu.classList.toggle('submenu-visible');
           icon.classList.toggle('rotate-180');
       } else {
           console.log("Submenu toggle ignored (desktop collapsed).");
       }
     }

      function toggleDesktopSidebar() {
        if (!desktopSidebar || !desktopToggleIcon || !desktopToggleText || !desktopSidebarToggleBtn || !mainContent) return;
        const isCollapsed = desktopSidebar.classList.toggle('sidebar-collapsed');
        if (isCollapsed) {
            desktopToggleIcon.classList.replace('bi-chevron-double-left', 'bi-chevron-double-right');
            desktopToggleText.textContent = 'Expandir';
            desktopSidebarToggleBtn.setAttribute('aria-label', 'Expandir barra lateral');
            localStorage.setItem('desktopSidebarState', 'collapsed');
            document.querySelectorAll('#desktopSidebar .submenu.submenu-visible').forEach(sm => {
                sm.classList.remove('submenu-visible');
                const iconEl = sm.previousElementSibling?.querySelector('.submenu-toggle-icon');
                if(iconEl) iconEl.classList.remove('rotate-180');
            });
        } else {
            desktopToggleIcon.classList.replace('bi-chevron-double-right', 'bi-chevron-double-left');
            desktopToggleText.textContent = 'Recolher';
            desktopSidebarToggleBtn.setAttribute('aria-label', 'Recolher barra lateral');
            localStorage.setItem('desktopSidebarState', 'expanded');
        }
      }

       function applyDesktopSidebarState() {
         if (!desktopSidebar || !desktopToggleIcon || !desktopToggleText || !desktopSidebarToggleBtn || !mainContent) return;
         const savedState = localStorage.getItem('desktopSidebarState');
         if (savedState === 'collapsed') {
             desktopSidebar.classList.add('sidebar-collapsed');
             desktopToggleIcon.classList.replace('bi-chevron-double-left', 'bi-chevron-double-right');
             desktopToggleText.textContent = 'Expandir';
             desktopSidebarToggleBtn.setAttribute('aria-label', 'Expandir barra lateral');
         } else {
             desktopSidebar.classList.remove('sidebar-collapsed');
             desktopToggleIcon.classList.replace('bi-chevron-double-right', 'bi-chevron-double-left');
             desktopToggleText.textContent = 'Recolher';
             desktopSidebarToggleBtn.setAttribute('aria-label', 'Recolher barra lateral');
         }
       }

     function openProfileModal() {
        const profileLinkToActivate = sidebarProfileLinkDesktop || sidebarProfileLinkMobile;
        if (profileLinkToActivate) {
             setActiveLink(profileLinkToActivate);
        } else {
             console.warn("Sidebar profile link not found for activation.");
             const firstTrigger = document.querySelector('.profile-trigger');
             if (firstTrigger) setActiveLink(firstTrigger);
        }

       const currentUsername = localStorage.getItem('savedUsername') || 'Usuário Padrão';
       const currentProfilePicLarge = localStorage.getItem('savedProfilePicLarge') || DEFAULT_PROFILE_PIC_LARGE;
       profileNameInput.value = currentUsername;
       modalProfileImg.src = currentProfilePicLarge;
       document.getElementById('currentPassword').value = '';
       document.getElementById('newPassword').value = '';
       document.getElementById('confirmPassword').value = '';

       profileModal.classList.remove('hidden');
       profileModal.classList.add('flex');
       void profileModal.offsetWidth;
       profileModal.classList.add('opacity-100');
       profileModalContent.classList.remove('scale-95', 'opacity-0');
     }

     function closeProfileModal() {
       profileModal.classList.remove('opacity-100');
       profileModalContent.classList.add('scale-95', 'opacity-0');
       setTimeout(() => {
        profileModal.classList.add('hidden');
        profileModal.classList.remove('flex');
        const currentProfilePicLarge = localStorage.getItem('savedProfilePicLarge') || DEFAULT_PROFILE_PIC_LARGE;
        modalProfileImg.src = currentProfilePicLarge;
        profilePicInput.value = '';
        document.querySelectorAll('.profile-trigger, .profile-sidebar-link').forEach(el => el.classList.remove('active'));
       }, 200);
     }

     profilePicInput.addEventListener('change', function () {
       const file = this.files[0];
       if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
         modalProfileImg.src = e.target.result;
        };
        reader.readAsDataURL(file);
       }
     });

     profileForm.addEventListener('submit', function (e) {
       e.preventDefault();
       const newName = profileNameInput.value.trim();
       const newImgDataUrl = modalProfileImg.src.startsWith('data:image/') ? modalProfileImg.src : null;

       const currentPassword = document.getElementById('currentPassword').value;
       const newPassword = document.getElementById('newPassword').value;
       const confirmPassword = document.getElementById('confirmPassword').value;
       let passwordChangeAttempted = currentPassword || newPassword || confirmPassword;
       if (passwordChangeAttempted) {
           if (newPassword && newPassword === confirmPassword ) {
               console.log("Password change VALID (Placeholder):", newPassword);
           } else {
               console.log("Password change INVALID (Placeholder)");
               alert('Falha ao alterar senha. Verifique os campos.');
               return;
           }
       }

       if (newName) {
        localStorage.setItem('savedUsername', newName);
        if (newImgDataUrl) {
            localStorage.setItem('savedProfilePicLarge', newImgDataUrl);
        } else if (modalProfileImg.src === DEFAULT_PROFILE_PIC_LARGE) {
            localStorage.removeItem('savedProfilePicLarge');
        }

        updateUserInfo();
        closeProfileModal();
       } else {
        alert('O nome de usuário não pode ficar vazio.');
       }
     });

     function updateUserInfo() {
        const username = localStorage.getItem('savedUsername') || 'Nome Padrão';
        const profilePicBase64Large = localStorage.getItem('savedProfilePicLarge');

        const displayPicSmall = profilePicBase64Large || DEFAULT_PROFILE_PIC_SMALL;
        const displayPicMedium = profilePicBase64Large || DEFAULT_PROFILE_PIC_MEDIUM;
        const modalPic = profilePicBase64Large || DEFAULT_PROFILE_PIC_LARGE;

        if(profileNameHeaderMobile) profileNameHeaderMobile.textContent = username;
        // Removed sidebarProfileName update
        if(profileNameDesktop) profileNameDesktop.textContent = username;

        if(profileImgHeaderMobile) profileImgHeaderMobile.src = displayPicSmall;
        // Removed sidebarProfileImg update
        if(profileImgDesktop) profileImgDesktop.src = displayPicMedium;
        if(modalProfileImg) modalProfileImg.src = modalPic;
     }


     window.addEventListener('DOMContentLoaded', function () {
       console.log('DOM carregado. Verificando login...');
       const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
       console.log(`Logado: ${isLoggedIn}`);

       if (isLoggedIn) {
        console.log('Usuário logado. Exibindo dashboard...');
        hideFlexElement(loginOverlay);
        showFlexElement(dashboard);
        updateUserInfo();
        applyDesktopSidebarState();

        const homeLink = document.querySelector('#desktopSidebar .nav-link[onclick*="home.html"]') || document.querySelector('#mobileSidebar .nav-link[onclick*="home.html"]');
        if (homeLink) {
           loadPage('home.html', homeLink);
        } else {
           if(mainFrame) mainFrame.src = 'home.html';
           hideFlexElement(iframeSpinnerOverlay);
           console.warn("Link Home não encontrado.");
        }
        console.log('Dashboard pronto.');

       } else {
        console.log('Usuário NÃO logado. Exibindo login...');
        showFlexElement(loginOverlay);
        hideFlexElement(dashboard);
        hideElement(logoutNotification);
        hideElement(loginErrorDiv);

        const savedUsername = localStorage.getItem('savedUsername');
        const savedPassword = localStorage.getItem('savedPassword');
        usernameField.value = savedUsername || '';
        passwordField.value = '';
        rememberMe.checked = !!savedPassword;

        console.log('Tela de login pronta.');
       }
     });
  </script>

  <script src="https://cdn.botpress.cloud/webchat/v2.3/inject.js"></script>
  <script src="https://files.bpcontent.cloud/2025/04/11/14/20250411143158-L7UHR9R4.js"></script>

</body>
</html>
