<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>ClickForte | Financeiro (Novo Dark)</title>

  <!-- Tailwind + Bootstrap Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

  <style>
    /* ---------- RESET & BASE ---------- */
    html,body{margin:0;padding:0;min-height:-webkit-fill-available;-webkit-text-size-adjust:100%;-webkit-overflow-scrolling:touch;overscroll-behavior-y:contain;font-family:Inter,sans-serif;color-scheme:dark}
    body{padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);background:#1a1d21;color:#e9ecef}
    html{height:-webkit-fill-available;scroll-behavior:smooth}
    @media(max-width:768px){.h-screen{height:calc(var(--vh,1vh)*100)}}
    iframe{box-shadow:none;background:#1a1d21;border:none;width:100%;height:100%;display:block}
    :focus-visible{outline:2px solid rgb(77 171 247 / .5);outline-offset:2px}
    button:focus,a:focus,input:focus{outline:none}

    /* ---------- SCROLLBAR ---------- */
    ::-webkit-scrollbar{width:8px;height:8px}
    ::-webkit-scrollbar-thumb{background:#495057;border-radius:9999px;border:2px solid #212529}
    ::-webkit-scrollbar-track{background:#343a40;border-radius:9999px}

    /* ---------- GLOBAL HEADER ---------- */
    #profileHeader{
      position:sticky;top:0;z-index:30;
      padding-top:calc(env(safe-area-inset-top)+.75rem);padding-bottom:.75rem;
      background:rgba(26,29,33,.85);
      backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
      border-bottom:1px solid #495057
    }

    /* Active link (sidebar e header) */
    .nav-link.active{
      background:rgba(77,171,247,.15);
      color:#4dabf7;font-weight:500;border-left:4px solid transparent
    }
    #desktopSidebar:not(.sidebar-collapsed) .nav-link.active{
      border-left:4px solid #4dabf7;
      padding-left:calc(.75rem + 4px)
    }
    #desktopSidebar.sidebar-collapsed .nav-link{
      justify-content:center;padding-left:.75rem;padding-right:.75rem
    }
    #desktopSidebar.sidebar-collapsed .nav-link.active{
      border-left:none;padding-left:.75rem
    }
    .nav-link.active i:not(.submenu-toggle-icon){color:#4dabf7}

    /* Submenu link ativo */
    .submenu .nav-link.active{
      border-left:none;padding-left:.5rem;
      background:rgba(77,171,247,.1);color:#e9ecef
    }

    .submenu{max-height:0;overflow:hidden;transition:max-height .35s ease-out}
    .submenu-visible{max-height:500px}

    @keyframes shake{10%,90%{transform:translate3d(-1px,0,0)}20%,80%{transform:translate3d(2px,0,0)}30%,50%,70%{transform:translate3d(-3px,0,0)}40%,60%{transform:translate3d(3px,0,0)}}
    .animate-shake{animation:shake .5s cubic-bezier(.36,.07,.19,.97) both}

    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    .text-xs\+{font-size:.8125rem;line-height:1.25rem}

    #iframeSpinnerOverlay>div{border-color:#4dabf7;border-bottom-color:transparent}

    /* ---------- DESKTOP SIDEBAR WIDTH ---------- */
    #desktopSidebar{transition:width .3s ease-in-out;width:16rem;flex-shrink:0}
    #mainContent{transition:width .3s ease-in-out;flex:1;min-width:0}
    #desktopSidebar.sidebar-collapsed{width:5rem}

    #desktopSidebar.sidebar-collapsed .sidebar-text,
    #desktopSidebar.sidebar-collapsed .sidebar-logo-full,
    #desktopSidebar.sidebar-collapsed #sidebarProfileName,
    #desktopSidebar.sidebar-collapsed #sidebarProfileViewText,
    #desktopSidebar.sidebar-collapsed .submenu-toggle-icon,
    #desktopSidebar.sidebar-collapsed .submenu{display:none}
    #desktopSidebar.sidebar-collapsed .nav-link i:not(.submenu-toggle-icon){margin-right:0}
    #desktopSidebar.sidebar-collapsed .nav-link{justify-content:center}
    #desktopSidebar.sidebar-collapsed .profile-section-bottom{padding-left:.5rem;padding-right:.5rem}
    #desktopSidebar.sidebar-collapsed .profile-section-bottom>div:first-child{gap:.5rem;padding:.25rem}
    #desktopSidebar.sidebar-collapsed #sidebarProfileImg{width:2rem;height:2rem}
    #desktopSidebar.sidebar-collapsed .logo-container{height:60px;justify-content:center}
    #desktopSidebar.sidebar-collapsed #desktopSidebarToggle button{justify-content:center}
    #desktopSidebar .overflow-y-auto{overflow-y:auto}
  </style>
</head>
<body class="min-h-screen overflow-y-auto antialiased">

  <!-- ---------- LOGIN OVERLAY ---------- -->
  <!-- (o bloco de login permanece idêntico ao original) -->
  <div id="loginOverlay" class="fixed inset-0 flex items-center justify-center p-4 z-50 bg-[#1a1d21]/80 backdrop-blur-sm">
    <!-- ...conteúdo inalterado... -->
  </div>

  <!-- ---------- WELCOME SCREEN ---------- -->
  <div id="welcomeScreen" class="fixed inset-0 bg-[#1a1d21] z-70 hidden items-center justify-center flex-direction-column opacity-0 transition-opacity duration-500 ease-in-out">
     <!-- ...conteúdo inalterado... -->
  </div>

  <!-- ---------- DASHBOARD ---------- -->
  <div id="dashboard" class="hidden flex flex-col min-h-screen">
    <!-- ======= HEADER (mobile + desktop) ======= -->
    <header id="profileHeader" class="flex items-center justify-between px-4 shadow-sm">
      <!-- Botão de menu – apenas telas < md -->
      <button id="mobileMenuBtn"
              onclick="toggleMobileSidebar()"
              class="p-2 -ml-2 text-[#adb5bd] hover:text-[#4dabf7] hover:bg-[#343a40] rounded-full md:hidden"
              aria-label="Abrir menu">
        <i class="bi bi-list text-xl"></i>
      </button>

      <!-- Link Integração -->
      <a href="#"
         id="integrationHeaderLink"
         onclick="loadPage('integracao.html', this); return false;"
         class="nav-link flex items-center gap-2 px-3 py-2 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef]">
        <i class="bi bi-arrows-angle-contract text-lg"></i>
        <span class="hidden sm:inline text-sm font-medium">Integração</span>
      </a>

      <!-- Foto + Nome -->
      <div class="flex items-center cursor-pointer group"
           onclick="openProfileModal()">
        <span id="profileNameHeader"
              class="font-medium mr-2 hidden sm:inline text-[#e9ecef] group-hover:text-[#4dabf7] transition-colors duration-150">
          Nome do Usuário
        </span>
        <img id="profileImgHeader"
             src="https://via.placeholder.com/40"
             alt="Perfil"
             class="w-8 h-8 rounded-full object-cover ring-2 ring-offset-2 ring-offset-[#1a1d21] ring-[#4dabf7] group-hover:ring-[#63bfff] transition-all duration-150" />
      </div>
    </header>

    <!-- ======= LAYOUT: SIDEBAR + MAIN ======= -->
    <div class="flex flex-1 overflow-hidden">

      <!-- ======= DESKTOP SIDEBAR ======= -->
      <nav id="desktopSidebar"
           class="hidden md:flex flex-col bg-[#212529] text-[#adb5bd] shadow-md h-screen sticky top-0 border-r border-[#495057]">

        <!-- LOGO -->
        <div id="sidebarLogoContainer"
             class="logo-container p-5 flex flex-col items-center border-b border-[#495057] h-[60px] justify-center">
          <img src="https://war-machine.s3.sa-east-1.amazonaws.com/seller/521/logo/96169866-logo-alta-2552x1080.png"
               alt="Logo ClickForte"
               class="sidebar-logo-full mx-auto h-9 w-auto" />
        </div>

        <!-- LINKS -->
        <div class="overflow-y-auto flex-grow p-3 space-y-1">
          <!-- Home -->
          <a href="#"
             onclick="loadPage('home.html', this); return false;"
             class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef]">
            <i class="bi bi-house-door-fill w-5 text-center text-lg"></i>
            <span class="sidebar-text text-sm font-medium">Home</span>
          </a>

          <!-- (Integração removido do sidebar desktop) -->

          <!-- ---------- PREVISÃO ---------- -->
          <div class="nav-item">
            <button onclick="toggleSubmenu('desktopPrevisaoSubmenu', 'desktopPrevisaoIcon')"
                    class="nav-link flex items-center justify-between gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef] w-full text-left">
              <span class="flex items-center gap-3">
                <i class="bi bi-calendar-event-fill w-5 text-center text-lg"></i>
                <span class="sidebar-text text-sm font-medium">Previsão</span>
              </span>
              <i id="desktopPrevisaoIcon"
                 class="submenu-toggle-icon bi bi-chevron-down text-xs transition-transform duration-300"></i>
            </button>
            <div id="desktopPrevisaoSubmenu"
                 class="submenu pl-6 ml-4 mt-1 space-y-0.5 border-l border-[#495057]">
              <a href="#" onclick="loadPage('previsao_abril.html', this); return false;"
                 class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">
                Abril
              </a>
            </div>
          </div>

          <!-- ---------- GASTOS ---------- -->
          <div class="nav-item">
            <button onclick="toggleSubmenu('desktopGastosSubmenu', 'desktopGastosIcon')"
                    class="nav-link flex items-center justify-between gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef] w-full text-left">
              <span class="flex items-center gap-3">
                <i class="bi bi-wallet2 w-5 text-center text-lg"></i>
                <span class="sidebar-text text-sm font-medium">Gastos</span>
              </span>
              <i id="desktopGastosIcon"
                 class="submenu-toggle-icon bi bi-chevron-down text-xs transition-transform duration-300"></i>
            </button>
            <div id="desktopGastosSubmenu"
                 class="submenu pl-6 ml-4 mt-1 space-y-0.5 border-l border-[#495057]">
              <a href="#" onclick="loadPage('sub_janeiro.html', this); return false;"
                 class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Janeiro</a>
              <a href="#" onclick="loadPage('sub_fevereiro.html', this); return false;"
                 class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Fevereiro</a>
              <a href="#" onclick="loadPage('sub_marco.html', this); return false;"
                 class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Março</a>
              <a href="#" onclick="loadPage('sub_abril.html', this); return false;"
                 class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Abril</a>
            </div>
          </div>

          <!-- Relatório Geral -->
          <a href="#"
             onclick="loadPage('geral.html', this); return false;"
             class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef]">
            <i class="bi bi-graph-up w-5 text-center text-lg"></i>
            <span class="sidebar-text text-sm font-medium">Relatório Geral</span>
          </a>

          <!-- ---------- CONFIGURAÇÕES ---------- -->
          <div class="nav-item">
            <button onclick="toggleSubmenu('desktopConfigSubmenu', 'desktopConfigIcon')"
                    class="nav-link flex items-center justify-between gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef] w-full text-left">
              <span class="flex items-center gap-3">
                <i class="bi bi-gear-fill w-5 text-center text-lg"></i>
                <span class="sidebar-text text-sm font-medium">Configurações</span>
              </span>
              <i id="desktopConfigIcon"
                 class="submenu-toggle-icon bi bi-chevron-down text-xs transition-transform duration-300"></i>
            </button>
            <div id="desktopConfigSubmenu"
                 class="submenu pl-6 ml-4 mt-1 space-y-0.5 border-l border-[#495057]">
              <a href="#"
                 onclick="openProfileModal(); setActiveLink(this); return false;"
                 class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">
                <i class="bi bi-person-circle w-5 text-center text-base mr-1 -ml-1"></i> Perfil
              </a>
            </div>
          </div>
        </div>

        <!-- Toggle Sidebar -->
        <div id="desktopSidebarToggle" class="p-3 border-t border-[#495057]">
          <button onclick="toggleDesktopSidebar()"
                  class="flex items-center gap-3 w-full px-3 py-2.5 rounded-md text-[#adb5bd] hover:bg-[#343a40] hover:text-[#e9ecef] transition-colors duration-150"
                  aria-label="Recolher barra lateral">
            <i id="desktopToggleIcon"
               class="bi bi-chevron-double-left w-5 text-center text-lg"></i>
            <span class="sidebar-text text-sm font-medium">Recolher</span>
          </button>
        </div>

        <!-- Perfil no rodapé -->
        <div class="profile-section-bottom mt-auto p-3 border-t border-[#495057]">
          <div class="flex items-center gap-3 cursor-pointer group p-2 rounded-md hover:bg-[#343a40]"
               onclick="openProfileModal(); setActiveLink(document.querySelector('#desktopConfigSubmenu a[onclick*=\\'openProfileModal\\']')); ">
            <img id="sidebarProfileImg"
                 src="https://via.placeholder.com/40"
                 alt="Perfil"
                 class="w-9 h-9 rounded-full object-cover transition-all duration-200 group-hover:scale-105 ring-1 ring-[#495057] group-hover:ring-[#4dabf7]" />
            <div>
              <span id="sidebarProfileName"
                    class="sidebar-text font-medium text-sm text-[#e9ecef] block group-hover:text-[#4dabf7] transition-colors duration-150">
                Nome do Usuário
              </span>
              <span id="sidebarProfileViewText"
                    class="sidebar-text text-xs text-[#adb5bd]">Ver Perfil</span>
            </div>
            <button onclick="logout(); event.stopPropagation();"
                    class="ml-auto text-[#adb5bd] hover:text-red-500 hover:bg-red-900/30 p-1.5 rounded-full transition-colors duration-150"
                    aria-label="Sair">
              <i class="bi bi-box-arrow-right text-base"></i>
            </button>
          </div>
        </div>
      </nav>

      <!-- ======= CONTEÚDO PRINCIPAL ======= -->
      <main id="mainContent"
            class="overflow-y-auto p-4 md:p-6 relative bg-[#1a1d21]">
        <div id="iframeSpinnerOverlay"
             class="absolute inset-0 bg-[#1a1d21]/60 backdrop-blur-sm z-20 hidden items-center justify-center rounded-lg">
          <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#4dabf7]"></div>
        </div>
        <iframe id="mainFrame"
                src="home.html"
                class="w-full h-full rounded-lg shadow-md relative z-10 border border-[#495057]"
                title="Conteúdo Principal">
        </iframe>
      </main>
    </div>

    <!-- ======= MOBILE SIDEBAR ======= -->
    <div id="mobileSidebarWrapper"
         class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden"
         onclick="toggleMobileSidebar()"></div>

    <nav id="mobileSidebar"
         class="fixed top-0 left-0 bottom-0 w-64 bg-[#212529] text-[#adb5bd] h-screen flex flex-col shadow-xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden border-r border-[#495057]">
      <!-- Top bar -->
      <div class="p-4 flex justify-between items-center border-b border-[#495057] h-[60px]">
        <img src="https://war-machine.s3.sa-east-1.amazonaws.com/seller/521/logo/96169866-logo-alta-2552x1080.png"
             alt="Logo ClickForte"
             class="max-h-7 w-auto" />
        <button onclick="toggleMobileSidebar()"
                class="p-2 -mr-2 text-[#adb5bd] hover:text-[#4dabf7] hover:bg-[#343a40] rounded-full"
                aria-label="Fechar menu">
          <i class="bi bi-x-lg text-xl"></i>
        </button>
      </div>

      <!-- LINKS -->
      <div class="overflow-y-auto flex-grow p-3 space-y-1">
        <!-- Home -->
        <a href="#"
           onclick="loadPage('home.html', this); toggleMobileSidebar(); return false;"
           class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef]">
          <i class="bi bi-house-door-fill w-5 text-center text-lg"></i>
          <span class="text-sm font-medium">Home</span>
        </a>

        <!-- (Integração removido do sidebar mobile) -->

        <!-- ---------- PREVISÃO ---------- -->
        <div class="nav-item">
          <button onclick="toggleSubmenu('mobilePrevisaoSubmenu', 'mobilePrevisaoIcon')"
                  class="nav-link flex items-center justify-between gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef] w-full text-left">
            <span class="flex items-center gap-3">
              <i class="bi bi-calendar-event-fill w-5 text-center text-lg"></i>
              <span class="text-sm font-medium">Previsão</span>
            </span>
            <i id="mobilePrevisaoIcon"
               class="bi bi-chevron-down text-xs transition-transform duration-300"></i>
          </button>
          <div id="mobilePrevisaoSubmenu"
               class="submenu pl-6 ml-4 mt-1 space-y-0.5 border-l border-[#495057]">
            <a href="#"
               onclick="loadPage('previsao_abril.html', this); toggleMobileSidebar(); return false;"
               class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Abril</a>
            <a href="#"
               onclick="loadPage('previsao_maio.html', this); toggleMobileSidebar(); return false;"
               class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Maio</a>
            <a href="#"
               onclick="loadPage('previsao_dezembro.html', this); toggleMobileSidebar(); return false;"
               class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Dezembro</a>
          </div>
        </div>

        <!-- ---------- GASTOS ---------- -->
        <div class="nav-item">
          <button onclick="toggleSubmenu('mobileGastosSubmenu', 'mobileGastosIcon')"
                  class="nav-link flex items-center justify-between gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef] w-full text-left">
            <span class="flex items-center gap-3">
              <i class="bi bi-wallet2 w-5 text-center text-lg"></i>
              <span class="text-sm font-medium">Gastos</span>
            </span>
            <i id="mobileGastosIcon"
               class="bi bi-chevron-down text-xs transition-transform duration-300"></i>
          </button>
          <div id="mobileGastosSubmenu"
               class="submenu pl-6 ml-4 mt-1 space-y-0.5 border-l border-[#495057]">
            <a href="#"
               onclick="loadPage('sub_janeiro.html', this); toggleMobileSidebar(); return false;"
               class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Janeiro</a>
            <a href="#"
               onclick="loadPage('sub_fevereiro.html', this); toggleMobileSidebar(); return false;"
               class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Fevereiro</a>
            <a href="#"
               onclick="loadPage('sub_marco.html', this); toggleMobileSidebar(); return false;"
               class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Março</a>
            <a href="#"
               onclick="loadPage('sub_abril.html', this); toggleMobileSidebar(); return false;"
               class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">Abril</a>
          </div>
        </div>

        <!-- Relatório Geral -->
        <a href="#"
           onclick="loadPage('geral.html', this); toggleMobileSidebar(); return false;"
           class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef]">
          <i class="bi bi-graph-up w-5 text-center text-lg"></i>
          <span class="text-sm font-medium">Relatório Geral</span>
        </a>

        <!-- ---------- CONFIGURAÇÕES ---------- -->
        <div class="nav-item">
          <button onclick="toggleSubmenu('mobileConfigSubmenu', 'mobileConfigIcon')"
                  class="nav-link flex items-center justify-between gap-3 px-3 py-2.5 rounded-md transition-colors duration-150 hover:bg-[#343a40] hover:text-[#e9ecef] w-full text-left">
            <span class="flex items-center gap-3">
              <i class="bi bi-gear-fill w-5 text-center text-lg"></i>
              <span class="text-sm font-medium">Configurações</span>
            </span>
            <i id="mobileConfigIcon"
               class="bi bi-chevron-down text-xs transition-transform duration-300"></i>
          </button>
          <div id="mobileConfigSubmenu"
               class="submenu pl-6 ml-4 mt-1 space-y-0.5 border-l border-[#495057]">
            <a href="#"
               onclick="openProfileModal(); toggleMobileSidebar(); setActiveLink(this); return false;"
               class="block nav-link p-2 rounded-md text-xs+ hover:bg-[#343a40] hover:text-[#e9ecef]">
              <i class="bi bi-person-circle w-5 text-center text-base mr-1 -ml-1"></i> Perfil
            </a>
          </div>
        </div>
      </div>

      <!-- Botão sair -->
      <div class="p-3 mt-auto border-t border-[#495057]">
        <button onclick="logout()"
                class="w-full flex items-center justify-center gap-2 px-3 py-2.5 rounded-md text-red-400 bg-red-900/20 hover:bg-red-900/40 hover:text-red-300 transition-colors duration-150 text-sm font-medium">
          <i class="bi bi-box-arrow-left"></i> <span>Sair</span>
        </button>
      </div>
    </nav>
  </div>

  <!-- ---------- PROFILE MODAL ---------- -->
  <!-- (bloco modal permanece idêntico ao original) -->
  <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm hidden items-center justify-center z-50 p-4 transition-opacity duration-200 ease-in-out">
    <!-- ...conteúdo inalterado... -->
  </div>

  <!-- ---------- SCRIPTS ---------- -->
  <script>
    /* ======= TODAS AS VARIÁVEIS & FUNÇÕES ORIGINAIS ======= */
    // Referências de elementos
    const loginOverlay=document.getElementById('loginOverlay');
    const loginErrorDiv=document.getElementById('loginError');
    const formLogin=document.getElementById('formLogin');
    const usernameField=document.getElementById('username');
    const passwordField=document.getElementById('password');
    const rememberMe=document.getElementById('rememberMe');
    const loginButton=document.getElementById('loginButton');
    const buttonText=loginButton.querySelector('.button-text');
    const spinnerIcon=loginButton.querySelector('.spinner-icon');
    const togglePasswordButton=document.getElementById('togglePassword');
    const welcomeScreen=document.getElementById('welcomeScreen');
    const welcomeUserName=document.getElementById('welcomeUserName');
    const dashboard=document.getElementById('dashboard');
    const mainFrame=document.getElementById('mainFrame');
    const iframeSpinnerOverlay=document.getElementById('iframeSpinnerOverlay');
    const logoutNotification=document.getElementById('logoutNotification');
    const mobileSidebarWrapper=document.getElementById('mobileSidebarWrapper');
    const mobileSidebar=document.getElementById('mobileSidebar');
    const profileModal=document.getElementById('profileModal');
    const profileModalContent=document.getElementById('profileModalContent');
    const profileForm=document.getElementById('profileForm');
    const profileNameInput=document.getElementById('profileNameInput');
    const profilePicInput=document.getElementById('profilePicInput');
    const modalProfileImg=document.getElementById('modalProfileImg');
    const profileImgHeader=document.getElementById('profileImgHeader');
    const profileNameHeader=document.getElementById('profileNameHeader');
    const sidebarProfileImg=document.getElementById('sidebarProfileImg');
    const sidebarProfileName=document.getElementById('sidebarProfileName');
    const desktopSidebar=document.getElementById('desktopSidebar');
    const mainContent=document.getElementById('mainContent');
    const desktopSidebarToggleBtn=document.getElementById('desktopSidebarToggle')?.querySelector('button');
    const desktopToggleIcon=document.getElementById('desktopToggleIcon');
    const desktopToggleText=desktopSidebarToggleBtn?.querySelector('.sidebar-text');

    // Constantes
    const DEFAULT_PROFILE_PIC_SMALL='https://via.placeholder.com/40';
    const DEFAULT_PROFILE_PIC_LARGE='https://via.placeholder.com/100';

    /* ---------- FUNÇÕES ÚTEIS ---------- */
    function showElement(el){if(el)el.classList.remove('hidden')}
    function hideElement(el){if(el)el.classList.add('hidden')}
    function showFlexElement(el){if(el){el.classList.remove('hidden');el.classList.add('flex')}}
    function hideFlexElement(el){if(el){el.classList.remove('flex');el.classList.add('hidden')}}
    function disableButton(btn,textEl,spinnerEl){if(btn)btn.disabled=true;if(textEl)textEl.classList.add('hidden');if(spinnerEl)spinnerEl.classList.remove('hidden')}
    function enableButton(btn,textEl,spinnerEl){if(btn)btn.disabled=false;if(textEl)textEl.classList.remove('hidden');if(spinnerEl)spinnerEl.classList.add('hidden')}

    /* ---------- LOGIN / LOGOUT ---------- */
    formLogin.addEventListener('submit',function(e){
      e.preventDefault();hideElement(loginErrorDiv);disableButton(loginButton,buttonText,spinnerIcon);
      setTimeout(()=>{
        const validUsername=localStorage.getItem('savedUsername')||'admin';
        const username=usernameField.value.trim();
        const password=passwordField.value;
        if(username===validUsername&&password==='admin123'){
          handleSuccessfulLogin(username,password);
        }else{handleFailedLogin()}
      },1000)
    });
    function handleSuccessfulLogin(username,password){
      if(rememberMe.checked){
        localStorage.setItem('savedUsername',username);
        localStorage.setItem('savedPassword',password);
      }else{
        localStorage.removeItem('savedPassword');
        localStorage.setItem('savedUsername',username);
      }
      localStorage.setItem('isLoggedIn','true');
      hideFlexElement(loginOverlay);
      welcomeUserName.textContent=`Olá, ${username}! Carregando seu painel...`;
      welcomeScreen.classList.add('visible');
      setTimeout(()=>{
        welcomeScreen.classList.remove('visible');
        setTimeout(()=>{hideElement(welcomeScreen)},500);
        showFlexElement(dashboard);
        updateUserInfo();
        applyDesktopSidebarState();
        const homeLink=document.querySelector('#desktopSidebar .nav-link[onclick*="home.html"]')||
                        document.querySelector('#mobileSidebar .nav-link[onclick*="home.html"]');
        if(homeLink){loadPage('home.html',homeLink);}
        else{mainFrame.src='home.html';hideElement(iframeSpinnerOverlay);}
        enableButton(loginButton,buttonText,spinnerIcon);
      },2000)
    }
    function handleFailedLogin(){
      loginErrorDiv.textContent='Usuário ou senha incorretos.';
      showElement(loginErrorDiv);enableButton(loginButton,buttonText,spinnerIcon);
      const loginCard=loginOverlay.querySelector('.bg-\\[\\#212529\\]');
      if(loginCard){loginCard.classList.add('animate-shake');setTimeout(()=>loginCard.classList.remove('animate-shake'),500)}
    }
    togglePasswordButton.addEventListener('click',function(){
      const icon=this.querySelector('i');
      if(passwordField.type==='password'){
        passwordField.type='text';
        icon.classList.replace('bi-eye-slash','bi-eye');
        this.setAttribute('aria-label','Ocultar senha');
      }else{
        passwordField.type='password';
        icon.classList.replace('bi-eye','bi-eye-slash');
        this.setAttribute('aria-label','Mostrar senha');
      }
    });
    function logout(){
      localStorage.removeItem('isLoggedIn');
      hideFlexElement(dashboard);
      showFlexElement(loginOverlay);
      showElement(logoutNotification);
      setTimeout(()=>hideElement(logoutNotification),4000);
      if(mobileSidebar.classList.contains('translate-x-0')){toggleMobileSidebar()}
      passwordField.value='';
      hideElement(loginErrorDiv);
      const savedUsername=localStorage.getItem('savedUsername');
      const savedPassword=localStorage.getItem('savedPassword');
      usernameField.value=savedUsername||'';
      if(savedPassword){passwordField.value=savedPassword;rememberMe.checked=true;}
      else{rememberMe.checked=false;}
    }

    /* ---------- NAVEGAÇÃO ---------- */
    function setActiveLink(clicked){
      if(!clicked)return;
      document.querySelectorAll('#desktopSidebar .nav-link, #mobileSidebar .nav-link, #profileHeader .nav-link')
              .forEach(l=>l.classList.remove('active'));
      clicked.classList.add('active');

      const parentSubmenu=clicked.closest('.submenu');
      if(parentSubmenu){
        const parentButton=parentSubmenu.previousElementSibling;
        if(parentButton&&parentButton.classList.contains('nav-link')){
          parentButton.classList.add('active');
          const isCollapsed=desktopSidebar?.classList.contains('sidebar-collapsed');
          const context=parentSubmenu.id.includes('desktop')?'desktop':'mobile';
          if((context==='mobile'||!isCollapsed)&&!parentSubmenu.classList.contains('submenu-visible')){
            const parentIconId=parentButton.querySelector('i[id$="Icon"]')?.id;
            if(parentIconId){toggleSubmenu(parentSubmenu.id,parentIconId);}
          }
        }
      }
    }
    function loadPage(pageUrl,clicked){
      if(iframeSpinnerOverlay){iframeSpinnerOverlay.classList.remove('hidden');iframeSpinnerOverlay.classList.add('flex');}
      setActiveLink(clicked);
      if(mainFrame){mainFrame.src=pageUrl;}
      else{console.error("iframe 'mainFrame' não encontrado.");hideElement(iframeSpinnerOverlay);}
    }
    if(mainFrame&&iframeSpinnerOverlay){
      mainFrame.addEventListener('load',()=>{hideElement(iframeSpinnerOverlay);});
      mainFrame.addEventListener('error',e=>{
        console.error(`Falha ao carregar iframe: ${mainFrame.src}`,e);
        hideElement(iframeSpinnerOverlay);
      });
    }

    /* ---------- SIDEBAR ---------- */
    function toggleMobileSidebar(){
      const open=mobileSidebar.classList.contains('translate-x-0');
      if(open){
        mobileSidebar.classList.replace('translate-x-0','-translate-x-full');
        hideElement(mobileSidebarWrapper);
      }else{
        mobileSidebar.classList.replace('-translate-x-full','translate-x-0');
        showElement(mobileSidebarWrapper);
      }
    }
    function toggleSubmenu(submenuId,iconId){
      const submenu=document.getElementById(submenuId);
      const icon=document.getElementById(iconId);
      if(!submenu||!icon){console.error("Submenu/Icon não encontrado:",submenuId,iconId);return;}
      const context=submenuId.includes('desktop')?'desktop':'mobile';
      const isCollapsed=desktopSidebar?.classList.contains('sidebar-collapsed');
      if(context==='mobile'||!isCollapsed){
        document.querySelectorAll(`.submenu[id*="${context}"]`).forEach(other=>{
          if(other.id!==submenuId&&other.classList.contains('submenu-visible')){
            other.classList.remove('submenu-visible');
            const otherIcon=other.previousElementSibling?.querySelector('.submenu-toggle-icon');
            if(otherIcon)otherIcon.classList.remove('rotate-180');
          }
        });
        submenu.classList.toggle('submenu-visible');
        icon.classList.toggle('rotate-180');
      }
    }
    function toggleDesktopSidebar(){
      if(!desktopSidebar||!desktopToggleIcon||!desktopToggleText||!desktopSidebarToggleBtn){return;}
      const isCollapsed=desktopSidebar.classList.toggle('sidebar-collapsed');
      if(isCollapsed){
        desktopToggleIcon.classList.replace('bi-chevron-double-left','bi-chevron-double-right');
        desktopToggleText.textContent='Expandir';
        desktopSidebarToggleBtn.setAttribute('aria-label','Expandir barra lateral');
        localStorage.setItem('desktopSidebarState','collapsed');
        document.querySelectorAll('#desktopSidebar .submenu.submenu-visible').forEach(sm=>{
          sm.classList.remove('submenu-visible');
          sm.previousElementSibling?.querySelector('.submenu-toggle-icon')?.classList.remove('rotate-180');
        });
      }else{
        desktopToggleIcon.classList.replace('bi-chevron-double-right','bi-chevron-double-left');
        desktopToggleText.textContent='Recolher';
        desktopSidebarToggleBtn.setAttribute('aria-label','Recolher barra lateral');
        localStorage.setItem('desktopSidebarState','expanded');
      }
    }
    function applyDesktopSidebarState(){
      const savedState=localStorage.getItem('desktopSidebarState');
      if(savedState==='collapsed'){desktopSidebar.classList.add('sidebar-collapsed');}
      else{desktopSidebar.classList.remove('sidebar-collapsed');}
      if(desktopSidebar.classList.contains('sidebar-collapsed')){
        desktopToggleIcon.classList.replace('bi-chevron-double-left','bi-chevron-double-right');
        desktopToggleText.textContent='Expandir';
        desktopSidebarToggleBtn.setAttribute('aria-label','Expandir barra lateral');
      }else{
        desktopToggleIcon.classList.replace('bi-chevron-double-right','bi-chevron-double-left');
        desktopToggleText.textContent='Recolher';
        desktopSidebarToggleBtn.setAttribute('aria-label','Recolher barra lateral');
      }
    }

    /* ---------- PROFILE MODAL ---------- */
    function openProfileModal(){
      const currentUsername=localStorage.getItem('savedUsername')||'Usuário Padrão';
      const currentPic=localStorage.getItem('savedProfilePic')||DEFAULT_PROFILE_PIC_LARGE;
      profileNameInput.value=currentUsername;
      modalProfileImg.src=currentPic;
      document.getElementById('currentPassword').value='';
      document.getElementById('newPassword').value='';
      document.getElementById('confirmPassword').value='';
      profileModal.classList.remove('hidden');profileModal.classList.add('flex','opacity-100');
      profileModalContent.classList.remove('scale-95','opacity-0');
      const perfilLink=document.querySelector('#desktopConfigSubmenu a[onclick*="openProfileModal"]')||
                         document.querySelector('#mobileConfigSubmenu a[onclick*="openProfileModal"]');
      setActiveLink(perfilLink);
    }
    function closeProfileModal(){
      profileModal.classList.remove('opacity-100');
      profileModalContent.classList.add('scale-95','opacity-0');
      setTimeout(()=>{
        profileModal.classList.add('hidden');profileModal.classList.remove('flex');
        modalProfileImg.src=localStorage.getItem('savedProfilePic')||DEFAULT_PROFILE_PIC_LARGE;
        profilePicInput.value='';
      },200);
    }
    profilePicInput.addEventListener('change',function(){
      const file=this.files[0];
      if(file){
        const reader=new FileReader();
        reader.onload=e=>{modalProfileImg.src=e.target.result;}
        reader.readAsDataURL(file);
      }
    });
    profileForm.addEventListener('submit',function(e){
      e.preventDefault();
      const newName=profileNameInput.value.trim();
      const newImgSrc=modalProfileImg.src;
      const currentPassword=document.getElementById('currentPassword').value;
      const newPassword=document.getElementById('newPassword').value;
      const confirmPassword=document.getElementById('confirmPassword').value;
      if(currentPassword||newPassword||confirmPassword){
        if(newPassword&&newPassword===confirmPassword){
          console.log("Troca de senha (placeholder).");
        }else{
          alert('Erro ao validar a troca de senha.');return;
        }
      }
      if(newName){
        localStorage.setItem('savedUsername',newName);
        if(newImgSrc&&newImgSrc!==DEFAULT_PROFILE_PIC_LARGE&&newImgSrc.startsWith('data:image/')){
          localStorage.setItem('savedProfilePic',newImgSrc);
        }else if(!newImgSrc||newImgSrc===DEFAULT_PROFILE_PIC_LARGE){
          localStorage.removeItem('savedProfilePic');
        }
        updateUserInfo();closeProfileModal();
      }else{alert('O nome de usuário não pode ficar vazio.');}
    });
    function updateUserInfo(){
      const username=localStorage.getItem('savedUsername')||'Nome Padrão';
      const profilePic=localStorage.getItem('savedProfilePic')||DEFAULT_PROFILE_PIC_SMALL;
      profileNameHeader.textContent=username;
      sidebarProfileName.textContent=username;
      profileImgHeader.src=profilePic;
      sidebarProfileImg.src=profilePic;
      modalProfileImg.src=localStorage.getItem('savedProfilePic')||DEFAULT_PROFILE_PIC_LARGE;
    }

    /* ---------- INIT ---------- */
    window.addEventListener('DOMContentLoaded',()=>{
      const isLogged=localStorage.getItem('isLoggedIn')==='true';
      if(isLogged){
        hideFlexElement(loginOverlay);
        showFlexElement(dashboard);
        updateUserInfo();
        applyDesktopSidebarState();
        const homeLink=document.querySelector('#desktopSidebar .nav-link[onclick*="home.html"]')||
                        document.querySelector('#mobileSidebar .nav-link[onclick*="home.html"]');
        if(homeLink){loadPage('home.html',homeLink);}
        else{mainFrame.src='home.html';hideElement(iframeSpinnerOverlay);}
      }else{
        showFlexElement(loginOverlay);
        hideFlexElement(dashboard);
        const savedUsername=localStorage.getItem('savedUsername');
        const savedPassword=localStorage.getItem('savedPassword');
        usernameField.value=savedUsername||'';
        if(savedPassword){passwordField.value=savedPassword;rememberMe.checked=true;}
      }
    });

    /* ---------- UTIL: ALTURA VH ***********/
    function setVhProperty(){
      let vh=window.innerHeight*.01;
      document.documentElement.style.setProperty('--vh',`${vh}px`);
    }
    setVhProperty();
    window.addEventListener('resize',setVhProperty);
    window.addEventListener('orientationchange',setVhProperty);
  </script>

  <!-- Botpress -->
  <script src="https://cdn.botpress.cloud/webchat/v2.3/inject.js"></script>
  <script src="https://files.bpcontent.cloud/2025/04/11/14/20250411143158-L7UHR9R4.js"></script>
</body>
</html>
